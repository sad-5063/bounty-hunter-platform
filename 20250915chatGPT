let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

const taskForm = document.getElementById("taskForm");
const taskList = document.getElementById("tasks");

function renderTasks() {
  taskList.innerHTML = "";
  tasks.forEach((task, index) => {
    const li = document.createElement("li");
    li.className = "task";
    li.innerHTML = `
      <strong>${task.title}</strong> - ¥${task.reward}
      <p>${task.description}</p>
      <span class="status">状态: ${task.status}</span><br>
      ${
        task.status === "待接取"
          ? `<button onclick="acceptTask(${index})">接取任务</button>`
          : `<button onclick="completeTask(${index})">完成任务</button>`
      }
    `;
    taskList.appendChild(li);
  });
}

function saveTasks() {
  localStorage.setItem("tasks", JSON.stringify(tasks));
}

taskForm.addEventListener("submit", function (e) {
  e.preventDefault();
  const title = document.getElementById("title").value;
  const description = document.getElementById("description").value;
  const reward = document.getElementById("reward").value;

  tasks.push({
    title,
    description,
    reward,
    status: "待接取"
  });

  saveTasks();
  renderTasks();
  taskForm.reset();
});

function acceptTask(index) {
  tasks[index].status = "进行中";
  saveTasks();
  renderTasks();
}

function completeTask(index) {
  tasks[index].status = "已完成";
  saveTasks();
  renderTasks();
}

renderTasks();